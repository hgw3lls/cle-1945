<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Going to the Movies in Cleveland, 1945</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <style>
    body, html { margin:0; padding:0; height:100%; font-family:Arial, sans-serif; }
    #map { position:absolute; top:0; bottom:0; right:0; left:300px; }
    #sidebar {
      position:absolute; top:0; left:0; bottom:0; width:300px;
      background:#f8f9fa; border-right:1px solid #ddd; overflow:auto; padding:12px;
    }
    #homeBtn {
      width:100%; padding:10px 12px; border-radius:10px;
      border:1px solid #1d4ed8; background:#2563eb; color:#fff;
      font-weight:700; cursor:pointer;
    }
    #homeBtn:hover { background:#1d4ed8; }
    .section-title { font-weight:bold; margin-top:8px; margin-bottom:6px; }
    .btns button {
      width:100%; padding:8px 10px; margin:4px 0;
      border:1px solid #444; border-radius:6px;
      cursor:pointer; background:#eee;
    }
    .btns button:hover { background:#ddd; }
  </style>
</head>
<body>
  <div id="sidebar">
    <!-- Home button -->
    <div style="margin-bottom:12px;">
      <button id="homeBtn">Home View</button>
    </div>

    <!-- Intro -->
    <div class="section-title">GOING TO THE MOVIES IN CLEVELAND, 1945</div>
    <div style="font-size:14px; line-height:1.4; margin-bottom:12px; color:#333;">
      It&rsquo;s August 1945. The war is ending, the lights are back on downtown, and Cleveland&rsquo;s theaters are buzzing with crowds.
      This interactive map lets you relive that moment.<br><br>
      Just tap a theater dot to see what was on the marquee: the films playing that week, the house itself, and&mdash;when available&mdash;a photo, address, and a bit of its history.<br><br>
      Close the window to return to the map and stroll to the next showplace. When your tour is done, step back to the map&rsquo;s beginning and imagine the city as it was&mdash;alive with moviegoing.
    </div>

    <!-- Cache buttons -->
    <div class="btns">
      <button id="seedView">Save tiles in view</button>
      <button id="clearCache">Clear tile cache</button>
    </div>
  </div>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
  // --------- Base map init ----------
  const HOME_CENTER = [41.4993, -81.6944];
  const HOME_ZOOM = 13;
  const map = L.map('map').setView(HOME_CENTER, HOME_ZOOM);

  // Hybrid layers
  const imagery = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    { maxZoom: 19 }
  );
  const refLabels = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',
    { maxZoom: 19 }
  );
  const refRoads = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}',
    { maxZoom: 19 }
  );
  const hybrid = L.layerGroup([imagery, refLabels, refRoads]);

  const streets = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}',
    { maxZoom: 19 }
  );

  hybrid.addTo(map);

  L.control.layers(
    { "Hybrid (Imagery + Labels)": hybrid, "Streets": streets },
    null,
    { collapsed:false }
  ).addTo(map);

  // Home button resets view
  document.getElementById('homeBtn').addEventListener('click', () => {
    map.setView(HOME_CENTER, HOME_ZOOM);
    map.closePopup();
  });
  </script>

  <!-- Service Worker registration (GitHub Pagesâ€“safe) -->
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      var basePath = (function () {
        var p = location.pathname;
        if (p.endsWith('.html')) p = p.slice(0, p.lastIndexOf('/') + 1);
        if (!p.endsWith('/')) p += '/';
        var parts = p.split('/').filter(Boolean);
        if (parts.length > 0) return '/' + parts[0] + '/';
        return '/';
      })();

      var swUrl =
        location.hostname === 'localhost' || location.hostname === '127.0.0.1'
          ? './sw-cle-tiles.js'
          : basePath + 'sw-cle-tiles.js';

      var scope =
        location.hostname === 'localhost' || location.hostname === '127.0.0.1'
          ? './'
          : basePath;

      navigator.serviceWorker
        .register(swUrl, { scope: scope })
        .then(reg => console.log('ServiceWorker registered:', reg.scope))
        .catch(err => console.warn('ServiceWorker registration failed:', err));
    });
  }
  </script>
</body>
</html>
